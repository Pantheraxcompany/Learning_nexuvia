<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Nexuvia Academy Quiz Stars</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    }

    body {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #000;
      color: #fff;
    }

    .app {
      width: 100%;
      max-width: 900px;
      background: #101010;
      border-radius: 20px;
      padding: 20px 18px 24px;
      box-shadow: 0 16px 40px rgba(0, 0, 0, 0.7);
      border: 1px solid #333;
    }

    .app-header {
      text-align: center;
      margin-bottom: 16px;
    }

    .badge {
      display: inline-block;
      font-size: 11px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid #444;
      margin-bottom: 8px;
      color: #ccc;
    }

    h1 {
      font-size: 22px;
      margin-bottom: 4px;
    }

    .subtitle {
      font-size: 13px;
      color: #aaa;
    }

    .screen {
      display: none;
    }

    .screen.active {
      display: block;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 8px 16px;
      font-size: 14px;
      cursor: pointer;
      transition: transform 0.08s ease, box-shadow 0.08s ease,
        background 0.15s ease;
    }

    button:active {
      transform: scale(0.97);
      box-shadow: none;
    }

    .btn-primary {
      background: #fff;
      color: #000;
      font-weight: 600;
      box-shadow: 0 8px 18px rgba(255, 255, 255, 0.15);
    }

    .btn-outline {
      background: transparent;
      color: #fff;
      border: 1px solid #444;
    }

    .btn-full {
      width: 100%;
    }

    .row {
      display: flex;
      gap: 18px;
    }

    .col {
      flex: 1;
    }

    .label {
      font-size: 13px;
      color: #bbb;
      margin-bottom: 4px;
      display: block;
    }

    textarea,
    input {
      width: 100%;
      background: #111;
      border-radius: 10px;
      border: 1px solid #333;
      color: #fff;
      padding: 8px 10px;
      font-size: 13px;
      resize: vertical;
    }

    textarea:focus,
    input:focus {
      outline: none;
      border-color: #555;
    }

    .hint {
      font-size: 12px;
      color: #888;
      margin-top: 4px;
    }

    .center {
      text-align: center;
    }

    .info-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 13px;
      margin-bottom: 10px;
      color: #bbb;
    }

    .pill {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid #444;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .progress {
      height: 6px;
      background: #181818;
      border-radius: 999px;
      overflow: hidden;
      margin-bottom: 10px;
    }

    .progress-bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #ffffff, #aaaaaa);
      transition: width 0.2s ease;
    }

    .question-box {
      background: #171717;
      border-radius: 16px;
      padding: 14px 12px;
      margin-bottom: 12px;
      border: 1px solid #262626;
      font-size: 16px;
      line-height: 1.4;
    }

    .q-index {
      font-size: 12px;
      color: #888;
      margin-bottom: 3px;
    }

    .question-text {
      font-size: 16px;
    }

    .options {
      display: grid;
      gap: 8px;
      margin-bottom: 10px;
    }

    .option-btn {
      width: 100%;
      text-align: left;
      padding: 9px 12px;
      border-radius: 12px;
      border: 1px solid #262626;
      background: #141414;
      font-size: 14px;
      color: #eee;
      cursor: pointer;
      display: flex;
      gap: 8px;
      align-items: center;
      transition: background 0.15s ease, border-color 0.15s ease,
        transform 0.06s ease;
    }

    .option-btn span.label {
      font-size: 12px;
      opacity: 0.7;
    }

    .option-btn span.text {
      flex: 1;
    }

    .option-btn:hover {
      background: #1b1b1b;
    }

    .option-btn.correct {
      border-color: #32d27d;
      background: #0d1b14;
    }

    .option-btn.wrong {
      border-color: #ff4b4b;
      background: #2a0f0f;
    }

    .option-btn.disabled {
      pointer-events: none;
      opacity: 0.9;
    }

    .feedback {
      font-size: 13px;
      margin-bottom: 4px;
      min-height: 18px;
    }

    .feedback.correct {
      color: #5cf2a2;
    }

    .feedback.wrong {
      color: #ff7a7a;
    }

    .scoreboard-title {
      font-size: 14px;
      margin-bottom: 6px;
      color: #ccc;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .scoreboard {
      background: #151515;
      border-radius: 14px;
      border: 1px solid #262626;
      padding: 10px;
      max-height: 360px;
      overflow-y: auto;
      font-size: 13px;
    }

    .player-row {
      display: flex;
      flex-direction: column;
      gap: 4px;
      padding: 6px 4px;
      border-bottom: 1px solid #222;
    }

    .player-row:last-child {
      border-bottom: none;
    }

    .player-main {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .player-name {
      font-weight: 500;
    }

    .player-stars {
      font-size: 13px;
      color: #ffd76a;
    }

    .player-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 2px;
    }

    .btn-sm {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid #444;
      background: #111;
      color: #eee;
    }

    .btn-sm.primary {
      background: #fff;
      color: #000;
    }

    .result-box {
      text-align: center;
      padding: 10px 0 4px;
    }

    .result-label {
      font-size: 13px;
      color: #aaa;
      margin-bottom: 4px;
    }

    .ranking {
      margin-top: 10px;
      font-size: 13px;
    }

    .ranking-item {
      display: flex;
      justify-content: space-between;
      padding: 4px 0;
      border-bottom: 1px solid #222;
    }

    .ranking-item:last-child {
      border-bottom: none;
    }

    .tag {
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid #444;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #bbb;
    }

    @media (max-width: 800px) {
      .row {
        flex-direction: column;
      }
    }

    @media (max-width: 480px) {
      .app {
        border-radius: 0;
        max-width: 100%;
        min-height: 100vh;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- START SCREEN -->
    <div id="start-screen" class="screen active">
      <div class="app-header">
        <div class="badge">Nexuvia Academy • Quiz Stars</div>
        <h1>Quiz Operasi Bilangan</h1>
        <p class="subtitle">
          Soal penjumlahan, pengurangan, perkalian, dan pembagian dengan tanda kurung.
        </p>
      </div>

      <div class="row">
        <div class="col">
          <label class="label">Nama murid (pisahkan dengan koma)</label>
          <textarea id="player-names" rows="4" placeholder="Contoh:
Aldi, Anisa, Regina, Nur Laila"></textarea>
          <div class="hint">
            Sistem bintang:
            <br />• Pertama & benar: 4 ⭐
            <br />• Benar: 3 ⭐
            <br />• Salah: 1 ⭐
          </div>
        </div>
        <div class="col">
          <label class="label">Jumlah soal</label>
          <input type="number" id="total-questions-input" min="1" max="50" value="10" />
          <div class="hint">
            Soal diacak otomatis. Bentuk seperti:
            <br />• (a + b) × c
            <br />• (a + b + c) - d
            <br />• (a × b) ÷ c
            <br />• (a + b) ÷ c
          </div>
        </div>
      </div>

      <div style="margin-top:14px;" class="center">
        <button id="btn-start" class="btn-primary btn-full">Mulai Game di Laptop</button>
      </div>
    </div>

    <!-- QUIZ SCREEN -->
    <div id="quiz-screen" class="screen">
      <div class="info-row">
        <div class="pill">Mode: + - × ÷ dengan ()</div>
        <div id="question-count">Soal 1 dari 10</div>
      </div>

      <div class="progress">
        <div id="progress-bar" class="progress-bar"></div>
      </div>

      <div class="row" style="margin-top:10px;">
        <div class="col">
          <div class="question-box">
            <div class="q-index" id="question-index-text">Soal 1</div>
            <div class="question-text" id="question-text">
              Pertanyaan akan muncul di sini.
            </div>
          </div>

          <div class="options" id="options-container"></div>

          <div id="feedback" class="feedback"></div>

          <button id="btn-next" class="btn-outline btn-full" disabled>
            Soal Berikutnya
          </button>
        </div>

        <div class="col">
          <div class="scoreboard-title">
            <span>Scoreboard Nexies</span>
            <span class="tag">4⭐ / 3⭐ / 1⭐</span>
          </div>
          <div id="scoreboard" class="scoreboard"></div>
        </div>
      </div>
    </div>

    <!-- RESULT SCREEN -->
    <div id="result-screen" class="screen">
      <div class="app-header">
        <div class="badge">Hasil Game</div>
        <h1>Ranking Nexuvia Stars</h1>
        <p class="subtitle">
          Semakin cepat dan tepat, semakin banyak bintang yang terkumpul ⭐
        </p>
      </div>

      <div class="result-box">
        <div class="result-label">
          Rekap bintang semua murid:
        </div>
        <div id="ranking-list" class="ranking"></div>
      </div>

      <div style="margin-top:12px;" class="row">
        <div class="col">
          <button id="btn-restart" class="btn-primary btn-full">
            Main Lagi (Bintang di-reset)
          </button>
        </div>
        <div class="col">
          <button id="btn-back-home" class="btn-outline btn-full">
            Kembali ke Halaman Awal
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ========= UTIL RANDOM =========
    function randomInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function shuffleArray(arr) {
      const a = [...arr];
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function chooseDivisor(num) {
      const divs = [];
      for (let d = -10; d <= 10; d++) {
        if (d !== 0 && num % d === 0) divs.push(d);
      }
      if (divs.length === 0) return null;
      return divs[randomInt(0, divs.length - 1)];
    }

    // ========= GENERATOR SOAL: + - × ÷ DENGAN () & MAKS 4 BILANGAN =========
    function generateExpressionQuestion() {
      // Template dengan maksimal 4 bilangan dan tanda kurung
      const type = randomInt(1, 7);
      let expr = "";
      let answer = 0;

      let a, b, c, d, sum, prod, div;

      switch (type) {
        case 1:
          // (a + b) × c
          a = randomInt(-10, 10);
          b = randomInt(-10, 10);
          c = randomInt(-10, 10);
          answer = (a + b) * c;
          expr = `(${a} + ${b}) × ${c}`;
          break;
        case 2:
          // a + b × c
          a = randomInt(-10, 10);
          b = randomInt(-10, 10);
          c = randomInt(-10, 10);
          answer = a + b * c;
          expr = `${a} + ${b} × ${c}`;
          break;
        case 3:
          // (a × b) ÷ c
          a = randomInt(-8, 8) || 2;
          b = randomInt(-8, 8) || 3;
          prod = a * b;
          c = chooseDivisor(prod) || 1;
          answer = prod / c;
          expr = `(${a} × ${b}) ÷ ${c}`;
          break;
        case 4:
          // (a + b + c) - d
          a = randomInt(-10, 10);
          b = randomInt(-10, 10);
          c = randomInt(-10, 10);
          d = randomInt(-10, 10);
          answer = (a + b + c) - d;
          expr = `(${a} + ${b} + ${c}) - ${d}`;
          break;
        case 5:
          // a - (b + c)
          a = randomInt(-10, 10);
          b = randomInt(-10, 10);
          c = randomInt(-10, 10);
          answer = a - (b + c);
          expr = `${a} - (${b} + ${c})`;
          break;
        case 6:
          // a × (b - c)
          a = randomInt(-10, 10);
          b = randomInt(-10, 10);
          c = randomInt(-10, 10);
          answer = a * (b - c);
          expr = `${a} × (${b} - ${c})`;
          break;
        case 7:
          // (a + b) ÷ c
          a = randomInt(-10, 10);
          b = randomInt(-10, 10);
          sum = a + b;
          c = chooseDivisor(sum) || 1;
          answer = sum / c;
          expr = `(${a} + ${b}) ÷ ${c}`;
          break;
      }

      // Pilihan jawaban (4 opsi)
      const correct = answer;
      const choicesSet = new Set();
      choicesSet.add(correct);

      while (choicesSet.size < 4) {
        const delta = randomInt(-6, 6);
        if (delta === 0) continue;
        const candidate = correct + delta;
        choicesSet.add(candidate);
      }

      const rawChoices = shuffleArray(Array.from(choicesSet));
      const answerIndex = rawChoices.indexOf(correct);

      const displayChoices = rawChoices.map((v) => v.toString());

      return {
        question: `Hitung nilai dari: ${expr}`,
        choices: displayChoices,
        answerIndex: answerIndex,
      };
    }

    // ========= DOM ELEMENTS =========
    const startScreen = document.getElementById("start-screen");
    const quizScreen = document.getElementById("quiz-screen");
    const resultScreen = document.getElementById("result-screen");

    const btnStart = document.getElementById("btn-start");
    const btnNext = document.getElementById("btn-next");
    const btnRestart = document.getElementById("btn-restart");
    const btnBackHome = document.getElementById("btn-back-home");

    const playerNamesInput = document.getElementById("player-names");
    const totalQuestionsInput = document.getElementById("total-questions-input");

    const questionText = document.getElementById("question-text");
    const questionIndexText = document.getElementById("question-index-text");
    const questionCount = document.getElementById("question-count");
    const optionsContainer = document.getElementById("options-container");
    const feedbackEl = document.getElementById("feedback");
    const progressBar = document.getElementById("progress-bar");
    const scoreboardEl = document.getElementById("scoreboard");
    const rankingListEl = document.getElementById("ranking-list");

    // ========= STATE =========
    let players = []; // {name, stars}
    let currentIndex = 0;
    let totalQuestions = 10;
    let currentQuestion = null;

    // ========= SCOREBOARD RENDER =========
    function renderScoreboard() {
      scoreboardEl.innerHTML = "";
      if (players.length === 0) {
        scoreboardEl.innerHTML =
          '<div style="font-size:12px; color:#888;">Belum ada nama murid. Tambahkan di halaman awal.</div>';
        return;
      }

      players.forEach((p, idx) => {
        const row = document.createElement("div");
        row.className = "player-row";

        const main = document.createElement("div");
        main.className = "player-main";

        const nameSpan = document.createElement("span");
        nameSpan.className = "player-name";
        nameSpan.textContent = p.name;

        const starsSpan = document.createElement("span");
        starsSpan.className = "player-stars";
        starsSpan.textContent = `${p.stars} ⭐`;

        main.appendChild(nameSpan);
        main.appendChild(starsSpan);

        const actions = document.createElement("div");
        actions.className = "player-actions";

        const btn4 = document.createElement("button");
        btn4.className = "btn-sm primary";
        btn4.textContent = "4⭐ (Pertama & Benar)";
        btn4.addEventListener("click", () => addStars(idx, 4));

        const btn3 = document.createElement("button");
        btn3.className = "btn-sm";
        btn3.textContent = "3⭐ Benar";
        btn3.addEventListener("click", () => addStars(idx, 3));

        const btn1 = document.createElement("button");
        btn1.className = "btn-sm";
        btn1.textContent = "1⭐ Salah";
        btn1.addEventListener("click", () => addStars(idx, 1));

        actions.appendChild(btn4);
        actions.appendChild(btn3);
        actions.appendChild(btn1);

        row.appendChild(main);
        row.appendChild(actions);

        scoreboardEl.appendChild(row);
      });
    }

    function addStars(playerIndex, amount) {
      players[playerIndex].stars += amount;
      renderScoreboard();
    }

    // ========= QUIZ LOGIC =========
    function showScreen(screen) {
      [startScreen, quizScreen, resultScreen].forEach((s) =>
        s.classList.remove("active")
      );
      screen.classList.add("active");
    }

    function startGame() {
      // Ambil nama pemain
      const rawNames = playerNamesInput.value.trim();
      if (!rawNames) {
        // kasih default kalau kosong
        players = [
          { name: "Nexies 1", stars: 0 },
          { name: "Nexies 2", stars: 0 },
          { name: "Nexies 3", stars: 0 },
          { name: "Nexies 4", stars: 0 },
        ];
      } else {
        const names = rawNames
          .split(",")
          .map((n) => n.trim())
          .filter((n) => n.length > 0);
        players = names.map((n) => ({ name: n, stars: 0 }));
      }

      totalQuestions = parseInt(totalQuestionsInput.value, 10) || 10;
      if (totalQuestions < 1) totalQuestions = 1;
      if (totalQuestions > 50) totalQuestions = 50;

      currentIndex = 0;
      showScreen(quizScreen);
      renderScoreboard();
      loadQuestion();
    }

    function loadQuestion() {
      currentQuestion = generateExpressionQuestion();

      const total = totalQuestions;
      questionText.textContent = currentQuestion.question;
      questionIndexText.textContent = `Soal ${currentIndex + 1}`;
      questionCount.textContent = `Soal ${currentIndex + 1} dari ${total}`;

      const progressPercent = (currentIndex / total) * 100;
      progressBar.style.width = progressPercent + "%";

      optionsContainer.innerHTML = "";
      feedbackEl.textContent = "";
      feedbackEl.className = "feedback";
      btnNext.disabled = true;

      const labels = ["A", "B", "C", "D"];

      currentQuestion.choices.forEach((choice, idx) => {
        const btn = document.createElement("button");
        btn.className = "option-btn";
        btn.innerHTML = `
          <span class="label">${labels[idx]}.</span>
          <span class="text">${choice}</span>
        `;
        btn.addEventListener("click", () => handleAnswer(btn, idx));
        optionsContainer.appendChild(btn);
      });
    }

    function handleAnswer(clickedBtn, selectedIndex) {
      const optionButtons = optionsContainer.querySelectorAll(".option-btn");
      optionButtons.forEach((btn, idx) => {
        btn.classList.add("disabled");
        if (idx === currentQuestion.answerIndex) {
          btn.classList.add("correct");
        }
      });

      if (selectedIndex === currentQuestion.answerIndex) {
        feedbackEl.textContent = "Jawaban benar ✔️ Silakan beri bintang ke murid.";
        feedbackEl.classList.add("correct");
      } else {
        clickedBtn.classList.add("wrong");
        feedbackEl.textContent =
          "Jawaban salah ❌ Tunjukkan pembahasan dan beri bintang sesuai aturan.";
        feedbackEl.classList.add("wrong");
      }

      btnNext.disabled = false;
    }

    function nextQuestion() {
      currentIndex++;
      if (currentIndex >= totalQuestions) {
        endGame();
      } else {
        loadQuestion();
      }
    }

    function endGame() {
      showScreen(resultScreen);
      progressBar.style.width = "100%";

      const sorted = [...players].sort((a, b) => b.stars - a.stars);
      rankingListEl.innerHTML = "";

      sorted.forEach((p, idx) => {
        const row = document.createElement("div");
        row.className = "ranking-item";

        const left = document.createElement("span");
        left.textContent = `${idx + 1}. ${p.name}`;

        const right = document.createElement("span");
        right.textContent = `${p.stars} ⭐`;

        row.appendChild(left);
        row.appendChild(right);

        rankingListEl.appendChild(row);
      });
    }

    function resetAndRestart() {
      // reset semua bintang dan mulai game baru
      players = players.map((p) => ({ name: p.name, stars: 0 }));
      currentIndex = 0;
      showScreen(quizScreen);
      renderScoreboard();
      loadQuestion();
    }

    // ========= EVENT LISTENER =========
    btnStart.addEventListener("click", startGame);
    btnNext.addEventListener("click", nextQuestion);
    btnRestart.addEventListener("click", resetAndRestart);
    btnBackHome.addEventListener("click", () => {
      showScreen(startScreen);
      progressBar.style.width = "0%";
    });
  </script>
</body>
</html>